# Argon OpenAPI Generator

A powerful and flexible Roslyn source generator that creates C# DTOs and ASP.NET Core controllers from OpenAPI 3.1.1 specifications.

## Features

- ‚ú® **Automatic Code Generation**: Generate DTOs and controllers directly from OpenAPI specifications
- üéØ **Highly Configurable**: Control every aspect of code generation through MSBuild properties
- üìù **Modern C# Support**: Supports records, nullable reference types, required properties, and modern C# features
- ‚úÖ **Validation Attributes**: Automatically generate `DataAnnotations` validation attributes
- üìö **XML Documentation**: Generate comprehensive XML documentation comments from OpenAPI descriptions
- üöÄ **Async Support**: Generate async/await controller methods
- üîÑ **Incremental Generation**: Fast rebuild times with Roslyn incremental generators
- üé® **Customizable**: Configure namespaces, base classes, and code generation options

## Installation

Install via NuGet Package Manager:

```bash
dotnet add package Argon.OpenApiGenerator
```

Or add to your `.csproj` file:

```xml
<PackageReference Include="Argon.OpenApiGenerator" Version="1.0.0" />
```

## Quick Start

1. Add your OpenAPI specification file to your project
2. Mark it as `OpenApiGenerator` in your `.csproj`:

```xml
<ItemGroup>
  <AdditionalFiles Include="openapi.yaml" SourceItemType="OpenApiGenerator" />
</ItemGroup>
```

3. Build your project - generated files will appear in your IDE

## Configuration

Configure generation behavior using MSBuild metadata:

```xml
<ItemGroup>
  <AdditionalFiles Include="openapi.yaml" SourceItemType="OpenApiGenerator">
    <BaseNamespace>MyApp.Generated</BaseNamespace>
    <DtosNamespace>Models</DtosNamespace>
    <ControllersNamespace>Api</ControllersNamespace>
    <UseRecords>true</UseRecords>
    <GenerateValidationAttributes>true</GenerateValidationAttributes>
    <GenerateXmlDocumentation>true</GenerateXmlDocumentation>
    <UseAsyncControllers>true</UseAsyncControllers>
    <AddApiControllerAttribute>true</AddApiControllerAttribute>
    <ControllerBaseClass>ControllerBase</ControllerBaseClass>
  </AdditionalFiles>
</ItemGroup>
```

### Configuration Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `BaseNamespace` | string | `Generated` | Base namespace for generated types |
| `DtosNamespace` | string | `Dtos` | Namespace suffix for DTOs |
| `ControllersNamespace` | string | `Controllers` | Namespace suffix for controllers |
| `GenerateDtos` | bool | `true` | Generate DTO classes/records |
| `GenerateControllers` | bool | `true` | Generate controller classes |
| `UseRecords` | bool | `true` | Use records instead of classes for DTOs |
| `GenerateValidationAttributes` | bool | `true` | Generate DataAnnotations validation attributes |
| `GenerateXmlDocumentation` | bool | `true` | Generate XML documentation comments |
| `UseAsyncControllers` | bool | `true` | Generate async controller methods |
| `AddApiControllerAttribute` | bool | `true` | Add [ApiController] attribute |
| `ControllerBaseClass` | string | `ControllerBase` | Base class for controllers |

## Generated Code Examples

### DTO Example

From this OpenAPI schema:

```yaml
components:
  schemas:
    User:
      type: object
      required:
        - id
        - email
      properties:
        id:
          type: integer
          format: int64
        email:
          type: string
          format: email
          minLength: 5
          maxLength: 100
        name:
          type: string
```

Generates:

```csharp
// <auto-generated />
#nullable enable

using System;
using System.ComponentModel.DataAnnotations;

namespace Generated.Dtos;

/// <summary>
/// User model
/// </summary>
public record User
{
    [Required]
    public required long Id { get; set; }

    [Required]
    [StringLength(100, MinimumLength = 5)]
    public required string Email { get; set; }

    public string? Name { get; set; }
}
```

### Controller Example

From this OpenAPI path:

```yaml
paths:
  /users/{id}:
    get:
      tags:
        - Users
      summary: Get user by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Success
```

Generates:

```csharp
// <auto-generated />
#nullable enable

using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;
using Generated.Dtos;

namespace Generated.Controllers;

[ApiController]
[Route("api/users")]
public class UsersController : ControllerBase
{
    /// <summary>
    /// Get user by ID
    /// </summary>
    [HttpGet("{id}")]
    public async Task<IActionResult> GetUserByIdAsync([FromRoute] long id)
    {
        throw new System.NotImplementedException();
    }
}
```

## Requirements

- .NET Standard 2.0 compatible projects
- C# 10 or later (for generated code)
- Roslyn 4.0+ (Visual Studio 2022, Rider 2022.2+, or .NET 6+ SDK)

## Supported OpenAPI Features

- ‚úÖ OpenAPI 3.0 and 3.1
- ‚úÖ JSON and YAML formats
- ‚úÖ Schema components (objects, enums, arrays, primitives)
- ‚úÖ Path operations (GET, POST, PUT, DELETE, PATCH, etc.)
- ‚úÖ Parameters (path, query, header)
- ‚úÖ Request bodies
- ‚úÖ Validation constraints (min/max length, range, pattern, required)
- ‚úÖ Descriptions and summaries
- ‚úÖ Tags for controller grouping
- ‚úÖ Deprecated operations
- ‚úÖ AllOf, OneOf schema composition
- ‚úÖ Schema references ($ref)

## Limitations

- Response types are generated as `IActionResult` (implementation required)
- Complex authentication schemes need manual implementation
- Some advanced OpenAPI features may require manual adjustments

## Diagnostics

The generator emits diagnostic messages to help troubleshoot issues:

- **ARGON001**: OpenAPI Generation Error - Critical errors during code generation
- **ARGON002**: Invalid OpenAPI Document - Problems parsing the OpenAPI specification
- **ARGON003**: Configuration Warning - Configuration issues that may affect generation

For detailed information about each diagnostic code, see [DIAGNOSTICS.md](DIAGNOSTICS.md).

## Contributing

Contributions are welcome! Please feel free to submit issues and pull requests.

See [CONTRIBUTING.md](CONTRIBUTING.md) for detailed guidelines.

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Acknowledgments

Built with:
- [Microsoft.CodeAnalysis](https://github.com/dotnet/roslyn) - Roslyn compiler platform
- [Microsoft.OpenApi](https://github.com/microsoft/OpenAPI.NET) - OpenAPI.NET SDK

---

Made with ‚ù§Ô∏è by Flavien Chenu
